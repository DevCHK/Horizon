<script>
async function loadData() {
  try {
    const res = await fetch('data/data.json');
    if (!res.ok) throw new Error(`HTTP-Fehler! Status: ${res.status}`);
    const data = await res.json();

    // Farbe nach Ampelstatus
    function colorize(value) {
      if(value === 'green') return '#4ade80';
      if(value === 'yellow') return '#facc15';
      if(value === 'red') return '#f87171';
      return 'var(--text)';
    }

    // Trendpfeile
    function trendSymbol(current, previous) {
      if(previous === undefined || previous === null) return '';
      if(current > previous) return '▲';
      if(current < previous) return '▼';
      return '→';
    }

    // Werte anzeigen
    document.getElementById('spread').textContent =
      `${data.spread?.value ?? '–'} ${trendSymbol(data.spread?.value, data.previous?.spread?.value)}`;
    document.getElementById('spread').style.color = colorize(data.status?.spread);

    document.getElementById('vix').textContent =
      `${data.vix?.value ?? '–'} ${trendSymbol(data.vix?.value, data.previous?.vix?.value)}`;
    document.getElementById('vix').style.color = colorize(data.status?.vix);

    document.getElementById('hy').textContent =
      `${data.high_yield_bps?.value ?? '–'} ${trendSymbol(data.high_yield_bps?.value, data.previous?.high_yield_bps?.value)}`;
    document.getElementById('hy').style.color = colorize(data.status?.hy);

    document.getElementById('cape').textContent =
      `${data.shiller_cape?.value ?? '–'}`;
    document.getElementById('cape').style.color = colorize(data.status?.cape);

    document.getElementById('overall').textContent =
      data.status?.overall ?? '–';
    document.getElementById('overall').style.color = colorize(data.status?.overall);

    document.getElementById('last-updated').textContent =
      `Letzte Aktualisierung: ${data.timestamp_utc}`;

  } catch(e) {
    document.getElementById('last-updated').textContent =
      'Fehler beim Laden der Daten';
    console.error('Fehler beim Laden der Daten:', e);
  }
}

// Dark Mode automatisch nach System
if(window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches){
  document.documentElement.setAttribute('data-theme','dark');
}

loadData();
</script>
